/*
 * This Java source file was generated by the Gradle 'init' task.
 */
package adf.socket;

import java.util.stream.IntStream;

import com.proto.transporter.Object;
import com.proto.transporter.ObjectList;

import adf.socket.transpoter.BaseSocketTranspoter;
import adf.socket.transpoter.UnixDomainSocketTranspoter;

public class App {
    public static void main(String[] args) {
        BaseSocketTranspoter socketTranspoter = null;
        try {
            // socketTranspoter = new InetSocketTranspoter("localhost", 8080);
            socketTranspoter = new UnixDomainSocketTranspoter("/tmp/socket.sock");
        } catch (Exception e) {
            System.out.println(e);
        }
        if (socketTranspoter == null) {
            System.out.println("SocketTranspoter is null");
            return;
        }
        try {
            while (true) {
                ObjectList request = ObjectList.newBuilder()
                        .addAllObjects(IntStream.range(0, 100).boxed()
                                .map(i -> Object.newBuilder().setX(Math.random()).build())
                                .toList())
                        .build();
                ObjectList response = socketTranspoter.getSortedObjectList(request);
                System.out.println(response);
                Thread.sleep(1000);
            }
        } catch (InterruptedException ex) {
            System.out.println("Interrupted: " + ex.getMessage());
        } catch (Exception ex) {
            System.out.println("Exception: " + ex.getMessage());
        } finally {
            try {
                socketTranspoter.close();
            } catch (Exception ex) {
                System.out.println("Exception: " + ex.getMessage());
            }
        }
    }
}
